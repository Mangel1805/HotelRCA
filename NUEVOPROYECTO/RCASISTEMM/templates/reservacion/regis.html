<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="../../css/bootstrap.css" rel="stylesheet" type="text/css">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

{% extends "base.html" %}
{% block content %}
<div class="well">
<div class="row">
	

  <div class="alert alert-danger" role="alert"><H3>FORMULARIO DE RESERVACION</H3></div>

	 <div class="col-md-12">
	  <div class="col-md-3">
	 		 <label for="cedula">N° Habitación:</label>
                                <div class="input-group">
                                    <input class="form-control filtar" type="search" name="habitacion" id="txthabitacion" required autocomplete="off" placeholder="N° Habitación" onkeyup = "if(event.keyCode == 13) javascript:buscarHabitacion()"/ >
                 <span class="input-group-btn"><button class="btn btn-info" type="button" value="Buscar" onclick="javascript:buscarHabitacion()"><i class="glyphicon glyphicon-search"></i></button></span>
                                </div>
	 	</div>
	 	 <div class="col-md-5">
   			 <div class="col-md-2">
		    <br/>
		    Tipo
		    </div>
		    <div class="col-md-8">
		    <br/>
		      <input type="text" class="form-control" id="txttipo" readonly="readonly" placeholder="Tipo de habitación">
	 		</div>
	 	</div>
	 	 <div class="col-md-4">
   			 <div class="col-md-3">
		    <br/>
		    Categoria
		    </div>
		    <div class="col-md-9">
		    <br/>
		      <input type="text" class="form-control tyheader" id="txtcategoria" readonly="readonly" placeholder="Categoría de Habitación">
	 		</div>
	 	</div>
       
    </div>

    <div class="col-md-6">
    <br/><br/>
      <div class="alert alert-danger" role="alert">DATOS DEL CLIENTE</div>
    <div>
    
        <div class="col-xs-6">

                                <label for="cedula">Cédula:</label>
                                <div class="input-group">
                                    <input class="form-control ty" type="search" name="cedula" id="txtcedula" required autocomplete="off" placeholder="Cedula" size="100" onkeyup = "if(event.keyCode == 13) javascript:buscarCliente()" / >
                                    <span class="input-group-btn"><button class="btn btn-info" type="button" value="Buscar" onclick="javascript:buscarCliente()" ><i class="glyphicon glyphicon-search"></i></button></span>
                                </div>
                                <label for="nombre">Nombre:</label>
                                <input type="text" class="form-control" name="nombre" id="txtnombre" placeholder="Nombre" readonly="readonly">
                                <label for="apellido">Apellido:</label>
                                <input type="text" class="form-control" name="apellido" id="txtapellido" placeholder="Apellido" readonly="readonly">
                            </div>
                            <div class="col-xs-6">
                                <div class="row-fluid">
                                    <label for="direccion">Dirección:</label>
                                    <input type="text" class="form-control" name="direccion" id="txtdireccion" placeholder="Direccion" readonly="readonly">
                                    <label for="ciudad">Ciudad:</label>
                                    <input type="text" class="form-control" name="ciudad" id="txtciudad" placeholder="Ciudad" readonly="readonly">
                                    <label for="tlfono">Teléfono:</label>
                                    <input type="text" class="form-control" name="tlfono" id="txttelefono" placeholder="Telefono" readonly="readonly">
                                </div>
                            </div>
      </div>
    	


    </div>


    <div class="col-md-6"> 
<br/><br/>
      <div class="alert alert-danger" role="alert">TIEMPO DE RESERVACIÓN</div>
      </div>
    <div class="col-md-2">
    </br>
     <label for="direccion">Fecha Inicio:</label>
    </div>

      <div class="col-md-3">
      </br>
   		<div class='input-group date' id='datetimepicker1'>
                    <input type='text' id="txtfecha_inicio" class="form-control" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
        </div>
         
	 </div>
	 <div class="col-md-2">
    </br>
     <label for="direccion">Fecha fin:</label>
    </div>

      <div class="col-md-3">
      </br>
   		<div class='input-group date' id='datetimepicker2'>
                    <input type='text' id="txtfecha_fin" class="form-control" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
        </div>
         
 	</div>

 	<div class="col-md-6">
    <div class="col-md-6">
    <div class="col-md-4">
    </br>
      <label for="direccion">ADULTOS:</label>
    </div>
      <div class="col-md-6">
       </br>
   		<select name="info" id="estadoAdulto" onChange="javascript:calcular()" class="mbn">
                    <optgroup label="">
                      <option value="1">1 personas</option>
                      <option value="2">2 personas</option>
                      <option value="3">3 personas</option>
                      <option value="4">4 personas</option>
                      <option value="5">5 personas</option>
                    </optgroup>

                  </select>
     </div>
    </div>
    <div class="col-md-6">
	     <div class="col-md-3">
		      </br>
		      <label for="direccion">NIÑOS:</label>
	    </div>
	     <div class="col-md-6">
	      </br>
	   		<select name="info" id="estadoNino" onChange="javascript:calcular()" class="mbn mbn-lg">
	                    <optgroup label="">
	                      <option value="0">0 niños</option>
	                      <option value="1">1 niños</option>
	                      <option value="2">2 niños</option>
	                      <option value="3">3 niños</option>
	                      <option value="4">4 niños</option>
	                      <option value="5">5 niños</option>
	                    </optgroup>

	                  </select>

	     </div>
	   
    </div>

	<div class="col-md-5">
	</div >
	<div class="col-md-6">
		<div class="col-md-5">
			      </br></br></br></br>
		      <h4><label for="direccion">Total a Pagar:</label></h4>
	  	</div>
    
        <div class="col-md-6">

			</br>
			</br>
			</br>
			</br>
			</br>
	  		 <input type="text " id="txttotal" class="form-control" placeholder="Pagar $">
    
        </div>
    </div>




      
  </div>
  <div class="row">
        <div class="col-xs-5"></div>
          <div class="col-xs-2">
            <button type="button" class="btn btn-danger" id="btnGuardar"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> GUARDAR</button>
          <i class="icon-save"></i></button></div>


          <button class="btn btn-info" type="button" value="Buscar" onclick="javascript:convertirfecha()" ><i class="glyphicon glyphicon-search"></i></button>
        <div class="col-xs-5"></div>

    </div>
</div>

{% endblock content %}

{% block js %}
<script >
		$(function () {
	                $('#datetimepicker1').datetimepicker();
	            });
		$(function () {
	                $('#datetimepicker2').datetimepicker();
	            });
		

		var cedulass=[]


    var cont  = 0;
      {% for cliente in listarclientes %}
      cedulass[cont]="{{cliente.cedula}}";
      console.log(cedulass[cont]);
      cont=cont+1;
      {% endfor %}
       $('input.ty').typeahead({
                      local: cedulass
        });

var habitaciones=[]


    var con  = 0;
      {% for habitacion in listarHabitacion %}
      habitaciones[con]="{{habitacion.habitacion}}";
      console.log(habitaciones[con]);
      con=con+1;
      {% endfor %}
       $('input.filtar').typeahead({
                      local: habitaciones
        });

 
    function buscarCliente(){
      var cedulaBuscar=document.getElementById("txtcedula").value;
      {% for cliente in listarclientes %}

          if("{{ cliente.cedula }}"==cedulaBuscar){
          var nombre = "{{cliente.nombre}}"
          var apellido = "{{cliente.apellido}}"
          var direccion = "{{cliente.direccion}}"
          var telefono = "{{cliente.telefono}}"
          var ciudad = "{{cliente.ciudad}}"
          document.getElementById("txtnombre").value=nombre;
          document.getElementById("txtapellido").value=apellido;
          document.getElementById("txtdireccion").value=direccion;
          document.getElementById("txttelefono").value=telefono;
          document.getElementById("txtciudad").value=ciudad;
          
         
        }
      {% endfor %}
    }
    function buscarHabitacion(){
      var habitacionBuscar=document.getElementById("txthabitacion").value;
      {% for habitacion in listarHabitacion %}

          if("{{ habitacion.habitacion }}"==habitacionBuscar){
         
          var tipo = "{{habitacion.tipo}}"
          var categoria = "{{habitacion.categoria}}"
          document.getElementById("txttipo").value=tipo;
          document.getElementById("txtcategoria").value=categoria;
          calcular();
        }
      {% endfor %}
    }
 	function obtenerCosto(){
      var habitacionBuscar=document.getElementById("txthabitacion").value;
      {% for habitacion in listarHabitacion %}

          if("{{ habitacion.habitacion }}"==habitacionBuscar){
         
          return ("{{habitacion.precio}}")
        }
      {% endfor %}
    }

     function convertirfecha(texto){
      var cadena =texto;
      var dia="";
      var mes="";
      var ano="";
     
      for(i=0; i<10; i++) 
        if ((i==1)||(i==0)){
           mes=mes+cadena.charAt(i);
        }else{
          if ((i==3)||(i==4)){
           dia=dia+cadena.charAt(i);
          }else{
            if((i==6)||(i==7)||(i==8)||(i==9)){
                ano=ano+cadena.charAt(i)
            }
          }
        }
        var fecha=ano+"-"+mes+"-"+dia
        return(fecha)
    }


    function re(texto){
      var cadena = texto;
      var aux='';
      for(i=0; i<cadena.length; i++) 
        if (cadena.charAt(i)==','){
           aux=aux+".";
        }else{
          aux=aux+cadena.charAt(i);
        }
        return aux;
    }
     
     function redondeo(numero){

      var flotante = parseFloat(numero);
      var resultado = Math.round(flotante*100)/100;
      return +(Math.round(flotante + "e+2")  + "e-2");
     

    }
     function calcular(){
     	var adulto=document.getElementById('estadoAdulto').value;
     	var nino=document.getElementById('estadoNino').value;
     	if(adulto>1){
			document.getElementById('txttotal').value= redondeo(re(obtenerCosto()))+ (parseInt(adulto-1)*10)+(parseInt(nino)*5);
     	}else{
     		document.getElementById('txttotal').value= redondeo(re(obtenerCosto()))+(parseInt(nino)*5);
     	}
     	
    
     }

		function m(){
		var ss=document.getElementById("txtfecha_inicio").value;
			return( ss)
		}



	$('#btnGuardar').click(function guardar(){

	    $.get('/reservacion/guardar/',{
	        Numerohabitacion:document.getElementById("txthabitacion").value,
	        cedula:document.getElementById("txtcedula").value, 
	        fecha_inicio:convertirfecha(document.getElementById("txtfecha_inicio").value), 
	        fecha_fin:convertirfecha(document.getElementById("txtfecha_fin").value), 
	        Nadultos:document.getElementById('estadoAdulto').value,
	        Nninos:document.getElementById('estadoNino').value,
			    total:document.getElementById("txttotal").value,   

	      });
	      alert("Datos Guardados Correctamente... ")
	      setTimeout("location.href='/reservacion/listar/'",100);
	  })






	</script>



{% endblock js %}